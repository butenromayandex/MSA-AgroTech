# ADR. Выбор архитектурного решения для системы мониторинга свиноферм

### **Название задачи:** Разработка архитектуры MVP системы мониторинга животных (AgroTech)
### **Автор:** Роман Бутенко
### **Дата:** 2026-01-28

### **Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| 1 | Видеокамера, Система | Детекция аномалий | Система анализирует видеопоток, выявляет драки или задавливание и фиксирует событие |
| 2 | Система, Оператор | Оповещение об инциденте | При обнаружении опасного события система отправляет уведомление оператору в течение 5 секунд |
| 3 | Датчик корма, Система | Контроль запасов | Система считывает уровень корма и прогнозирует расход |
| 4 | Ветврач, Система | Анализ здоровья | Система предоставляет отчет о здоровье животных на основе поведенческих паттернов |
| 5 | Система, ERP | Синхронизация данных | Система передает данные о поголовье и расходе ресурсов в 1С |
| 6 | Система | Работа офлайн | При потере связи система продолжает локальный мониторинг и накапливает данные |

### **Нефункциональные требования**

|**№**|**Требование**|
| :-: | :- |
| 1 | **Отказоустойчивость**: 99.95% доступности (High Availability) |
| 2 | **Производительность**: Реакция на инцидент < 5 секунд |
| 3 | **Автономность**: Работа при отсутствии интернета (Local First) |
| 4 | **Масштабируемость**: Поддержка подключения новых ферм без простоя |
| 5 | **Безопасность**: Аутентификация и разделение ролей |

### **Решение**

Для реализации выбрана **Гибридная архитектура (Edge + Cloud)**.
Это решение подразумевает наличие локального сервера на каждой ферме (Edge-сервер), который берет на себя критические задачи (видеоаналитика, управление кормушками, локальные алерты), и центрального облачного сервера для агрегации данных, глобальной аналитики и интеграции с ERP.

**Диаграмма контекста (Main):**
![C1 Main](./c1_main.puml)

**Обоснование:**
1.  **Нестабильный интернет:** Главное требование — работа офлайн. Видеопотоки "тяжелые", передавать их в облако при плохом канале невозможно. Аналитика должна быть локальной.
2.  **Latency:** Реакция 5 секунд требует обработки "на месте". Round-trip до облака может превысить лимиты.
3.  **Безопасность данных:** Первичная обработка внутри контура фермы.

### **Альтернативы**

**Альтернатива: Полностью облачное решение (Cloud Native)**
В этом варианте на ферме остаются только "глупые" датчики и камеры, которые стримят данные напрямую в облако.

**Диаграмма контекста (Alt):**
![C1 Alt](./c1_alt.puml)

### **Недостатки, ограничения, риски**

**Основное решение (Гибрид):**
*   **Сложность эксплуатации:** Нужно обслуживать физические серверы на фермах.
*   **Стоимость оборудования:** Закупка мощных серверов (GPU) для каждой фермы.
*   **Синхронизация:** Сложность разрешения конфликтов данных при восстановлении связи.

**Альтернативное решение (Cloud):**
*   **Зависимость от связи:** При обрыве интернета система "слепнет". (Критический риск).
*   **Трафик:** Огромные затраты на передачу видеопотоков.
*   **Задержки:** Риск не уложиться в 5 секунд.

**Вывод:** Из-за требований к автономности и низкой задержке, Гибридное решение является приоритетным.
